---
title: "R Notebook"
output: html_notebook
---

 

```{r}
## poisson regression
poem <- read.csv("//Users/jianingyi/Documents/Documents - Jenny Yi’s MacBook Air/mssp/ma676/consulting/MA677_Poem_project/poem_project.csv")
poem$end <- as.factor(poem$end )
poem$followed <- as.factor(poem$followed )
poem$poem6 <- as.factor(poem$poem6 )

model0 <- glm(count ~ poem2+poem3+poem4+poem5+poem6+end+followed, family = poisson, data = poem)
model1 <- glm(count ~ poem2+poem3+poem4+poem5+poem6+end+followed+poem6:end+poem6:followed, family = poisson, data = poem)
```


```{r}
model0_summary <- summary(model0)

# 获取coefficients矩阵的行名
coefficient_names <- rownames(model0_summary$coefficients)

# 替换行名以反映新的标签
coefficient_names <- sub("^followed$", "Followed by Nothing", coefficient_names)
coefficient_names <- sub("followed1", "Followed by Vowel", coefficient_names)
coefficient_names <- sub("followed2", "Followed by Consonant", coefficient_names)
coefficient_names <- sub("^end$", "End with As", coefficient_names)
coefficient_names <- sub("end1", "End with Ous", coefficient_names)

# 重新赋值coefficients矩阵的行名
rownames(model0_summary$coefficients) <- coefficient_names

# 打印修改后的summary对象
print(model0_summary)
```


```{r}
model1_summary <- summary(model1)

# 获取coefficients矩阵的行名
coefficient_names <- rownames(model1_summary$coefficients)
coefficient_names <- sub("followed1", "Followed by Vowel", coefficient_names)
coefficient_names <- sub("followed2", "Followed by Consonant", coefficient_names)
coefficient_names <- sub("poem61:followed1", "Poem6 & Followed by Vowel", coefficient_names)
coefficient_names <- sub("poem61:followed2", "Poem6 & Followed by Consonant", coefficient_names)

# 对于end变量的更改
coefficient_names <- sub("end1", "End with Ous", coefficient_names)

# 如果还有end和poem6的交互项也需要改名
coefficient_names <- sub("poem61:end1", "Poem6 & End with Ous", coefficient_names)

# 重新赋值coefficients矩阵的行名
rownames(model1_summary$coefficients) <- coefficient_names

# 打印修改后的summary对象
print(model1_summary)
```


```{r}
## likelyhood ratio test
lrt_result <- anova(model0, model1, test="Chisq")
lrt_result
```
```{r}
par(mfrow=c(1,2)) 
plot(model0, which=1) 
abline(h=0, col="red") 
title(main="Residuals vs Fitted for model")

plot(model1, which=1) 
abline(h=0, col="red") 
title(main="Residuals vs Fitted for model2")
```


```{r}
# binned residual plots
library(arm)
old.par <- par(no.readonly = TRUE)
x <- predict(model)
 y <- resid(model)
 binnedplot(x,y)
par(old.par)
x <- predict(model2)
y <- resid(model2)
binnedplot(x,y)
```




```{r}
# K mean cluster
library(tidyverse)
library(readxl)
poems_data <- read_excel("poem.xls")
poems_data <- poems_data %>% mutate_at(vars(-poem), as.numeric)
poems_features <- select(poems_data, -poem)
# Set the number of clusters; you might need to adjust this based on your data
k <- 2
# Perform K-means clustering
set.seed(123)  # Set a random seed for reproducibility
clusters <- kmeans(poems_features, centers = k, nstart = 20)
# Add cluster assignments back to the data
poems_data$Cluster <- clusters$cluster
# Check which cluster 'poem6' is in and how many other poems are in the same cluster
poem6_cluster <- poems_data %>% filter(poem == "6") %>% pull(Cluster)
cluster_counts <- poems_data %>% count(Cluster)
cat("Poem6 is in cluster:", poem6_cluster, "\n")
cat("The number of poems in each cluster:\n")
print(cluster_counts)
# Perform PCA
pca_result <- prcomp(poems_features, center = TRUE, scale. = TRUE)
# Create a data frame for plotting
plot_data <- data.frame(x = pca_result$x[,1], y = pca_result$x[,2], Cluster = as.factor(poems_data$Cluster))
# Plot the PCA results with clusters
ggplot(plot_data, aes(x = x, y = y, color = Cluster, label = row.names(poems_data))) +
  geom_point() +
  geom_text(hjust = 0, vjust = 0) +  # Adjust the position of text labels
  theme_minimal() +
  labs(title = "PCA of Poems with K-means Clusters", x = "PC1", y = "PC2")
```


```{r}
poems_features1 <- select(poems_data,asC,ousC)
k <- 3
# Perform K-means clustering
set.seed(456)  # Set a random seed for reproducibility
clusters <- kmeans(poems_features1, centers = k, nstart = 20)
# Add cluster assignments back to the data
poems_data$Cluster <- clusters$cluster
# Check which cluster 'poem6' is in and how many other poems are in the same cluster
poem6_cluster <- poems_data %>% filter(poem == "6") %>% pull(Cluster)
cluster_counts <- poems_data %>% count(Cluster)
cat("Poem6 is in cluster:", poem6_cluster, "\n")
cat("The number of poems in each cluster:\n")
print(cluster_counts)
# Perform PCA
pca_result <- prcomp(poems_features, center = TRUE, scale. = TRUE)
# Create a data frame for plotting
plot_data <- data.frame(x = pca_result$x[,1], y = pca_result$x[,2], Cluster = as.factor(poems_data$Cluster))
# Plot the PCA results with clusters
ggplot(plot_data, aes(x = x, y = y, color = Cluster, label = row.names(poems_data))) +
  geom_point() +
  geom_text(hjust = 0, vjust = 0) +  # Adjust the position of text labels
  theme_minimal() +
  labs(title = "PCA of Poems with K-means Clusters", x = "PC1", y = "PC2")
```

